# Run scheduled jobs to catch breakages from Rust nightly or dependency updates
name: Scheduled
permissions:
  contents: read

on:
  schedule:
    - cron: '0 7 * * *'  # Daily at 7:00 UTC
  workflow_dispatch:  # Allow manual triggering

env:
  CARGO_TERM_COLOR: always

jobs:
  nightly:
    name: nightly
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2
      - name: Install nightly
        uses: dtolnay/rust-toolchain@f7ccc83f9ed1e5b9c81d8a67d7ad1a747e22a561 # master
        with:
          toolchain: nightly
          components: clippy
      - name: cargo clippy
        run: cargo clippy --manifest-path backend/Cargo.toml -- -D warnings
      - name: cargo test
        run: cargo test --manifest-path backend/Cargo.toml

  updated-deps:
    name: updated deps
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@de0fac2e4500dabe0009e67214ff5f5447ce83dd # v6.0.2
      - name: Install stable
        uses: dtolnay/rust-toolchain@f7ccc83f9ed1e5b9c81d8a67d7ad1a747e22a561 # master
        with:
          toolchain: stable
      - name: cargo update
        run: cargo update --manifest-path backend/Cargo.toml
      - name: cargo test
        run: cargo test --manifest-path backend/Cargo.toml
        env:
          RUSTFLAGS: -D deprecated
